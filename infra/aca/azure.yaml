name: react-app
metadata:
  subscription: ${AZURE_SUBSCRIPTION_ID}
  resourceGroup: ${AZURE_RESOURCE_GROUP}
  location: ${AZURE_LOCATION}
infra:
  bicep: ./infra/main.bicep

services:
  UserPortal:
    project: ../../src/userportal
    host: containerapp
    language: js
    docker:
      context: ../../src/userportal
      path: DOCKERFILE
      registry: ${AZURE_CONTAINER_REGISTRY_ENDPOINT}
    dependsOn:
      - infra

  API:
    project: ../../src/api
    host: containerapp
    language: python
    docker:
      context: ../../src/api
      path: DOCKERFILE
      registry: ${AZURE_CONTAINER_REGISTRY_ENDPOINT}
    dependsOn:
      - infra

hooks:
  postdeploy:
    shell: pwsh
    continueOnError: false
    interactive: true
    run: ./azd-hooks/postdeploy.ps1
