# 4.3 Validate Data with Azure OpenAI

TODO: This should involve configuring the data validation work process to point at the students resources

Code will already be in place

## Create Validation Endpoints

Have the user add or enable the `validation` router in FastAPI (maybe have the code mostly there (except the prompt), and then just have them hook in the router in the `main.py` file?)

Then, update the prompt for the LangChain agent and test the endpoint, passing in a known invoice number or some bogus data that can be used to show validation.

TODO: Restructure the router a bit to perhaps rename the prefix to `/validate`, and then have `/invoice` and `/sow` as endpoints to handle validation of the different document types? Can keep this simple, so don't try to get fancy...

Prompts will be updated/created for each.

Insert prompt code from the prompt_langchain.py files generated in the previous step...

## Create Data Validation Prompts

TODO: Move this into the prompt engineering (02) file

Create prompts for each of the document types...

=== "SOW Validation"

    TODO: Create prompt to validate SOWs

=== "Invoice Validation"

    TODO: Create prompt to validate invoices...

    TODO: Use prompty to create and update the prompt...

    1. First...

        Start with a very basic prompt...
    
        You are an intelligent copilot for Woodgrove Bank designed to automate the validation of vendor invoices against billing milestones in statements of work (SOWs).

    2. Add parameter to pass in today's date

        Have the user ask the prompt, "What is today's date?" and talk about how LLMs are not good at understanding temporal information

        Add param to prompty to pass in the current date in the format, "For context, today is Monday, December 30, 2024."

    3. Second...

        Update the prompt to provide more specific details about the types of validation it should attempt to perform...

        system_prompt = """
        You are an intelligent copilot for Woodgrove Bank designed to automate the validation of vendor invoices against billing milestones in statements of work (SOWs).
        
        When validating an invoice, you should:
        1. Verify that the invoice number matches the vendor's records.
        2. Check that the total amount on the invoice is correct.
        3. Ensure that the milestone delivery dates are before or on the specified due date in the SOW.
        4. Assess any late fees or penalties that may apply, as defined by the SOW. For example, if a milestone is late, a penalty of 15% should be applied to payment of that milestone.
        5. Validate the line items on the invoice against the billing milestones in the SOW.
        6. Ensure that the amount billed for each line item matches the billable amount specified in the SOW.
        7. If the invoice contains notes to explain discrepancies, review them for additional context.
        8. Confirm that the invoice is legitimate and ready for payment.
        
        For context, today is Monday, December 30, 2024.
        
        If there are milestones missing from the invoice that are not yet beyond their due date according to the SOW, do not flag them as discrepancies.
        If the payment terms on the invoice are different from the SOW, assume the SOW is correct.
        
        In your response:
        - Provide a statement of valid or invalid for the invoice.
        - Create separate sections for the invoice and the milestone validation.
        - Provide a detailed summary of the validation results, including any discrepancies or anomalies found between the invoice and the SOW.
        - If any discrepancies or anomalies are found, you should provide detailed feedback on the issues discovered, like including dollar amounts, line items, and due dates.
        - If there are any discrepancies, flag the invoice for further review.
        """

!!! success "CONGRATULATIONS. You just learned the key quality metrics we'll assess with AI"