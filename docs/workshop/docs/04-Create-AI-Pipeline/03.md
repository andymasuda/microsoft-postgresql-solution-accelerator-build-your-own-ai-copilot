# 4.3 Summarize documents

TODO: Use the `azure_ai` extension's `azure_cognitive` schema to perform abstractive summarization on SOWs (and invoices?).

TODO: Summaries should be created using the extension as part of an update statement on the tables.

TODO: Perhaps have a button on the UI that kicks off the summarization process, or should it be part of the ingestion process? If so, the docs here will need to have them build the final insert queries over a few steps and then run it at the end, so minor restructuring, but probably the right way to go.


Leverage the azure_ai extension's azure_cognitive schema to perform abstractive summarization on SOWs (Statements of Work) and potentially invoices. This feature provides natural-language summaries that effectively encapsulate the intent and key details of the original text.

## Key Considerations for Abstractive Summarization

If you encounter the following error:

```bash
ERROR: azure_cognitive.summarize_abstractive: InvalidRequest: Invalid Request.
InvalidParameterValue: Job task: 'AbstractiveSummarization-task' failed with validation errors: ['Invalid Request.']
InvalidRequest: Job task: 'AbstractiveSummarization-task' failed with validation error: Document abstractive summarization is not supported in the region Central US. The supported regions are North Europe, East US, West US, UK South, Southeast Asia.
```

This indicates that the chosen Azure region does not support abstractive summarization. To resolve this:

Create a new Azure AI Language service in one of the supported regions listed in the error.
Use the same resource group as other lab resources for consistency.
Alternatively, substitute with extractive summarization, though it won't provide the opportunity to compare both techniques.
Integration of Summarization in Workflow
Summaries should be generated as part of an UPDATE statement within the database. Consider integrating this feature into the UI:

Add a button to initiate the summarization process manually.
Or, make it part of the ingestion pipeline, requiring adjustments to the document ingestion workflow.

## SOW Document Summarization Flow

When a document is uploaded, a summary is automatically generated during the database INSERT or UPDATE operations into the `sows` table using the `azure_cognitive.summarize_abstractive` function within the `src/api/app/routers/sows.py` code:

```psql
summary = azure_cognitive.summarize_abstractive($6, 'en', 2)
```

If `summarize_abstractive` function doesn't work in a specific region, the extractive summarization can be used as a fallback:

```psql
azure_cognitive.summarize_extractive($6, 'en', 2)
```

