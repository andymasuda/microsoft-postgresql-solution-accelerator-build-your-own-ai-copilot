# 6.5 Set Up GraphRAG

1. Add GraphRAG functionality
       1. Provide graph nodes for relationships between SOWs, vendors, and invoices. Also, linking invoice line items with milestones and deliverables in SOWs?

## Create and Query Graph Data

With AGE installed, you are ready to start creating and querying graph data using OpenCypher.

TODO: Expand on the below and provide good examples

In this example you use OpenCypher and AGE to determine the connections or relationships between the SOWs and vendors and invoices they have submitted.

To accomplish this, you will need to create a set of nodes (vertices) and relationships (edges):

Note: You will need to set the ag_catalog schema in your path to utilize cypher or you will need to specify it directly in the query as shown in the following examples:

```sql
SET search_path = ag_catalog, "$user", public;
```

Or

```sql
ag_catalog.cypher(query)
```










# 6.2 Create nodes



TODO: Fix the `graph_name` reference above to use a standard one for the solution accelerator so it doesn't need to be updated in the queries...

Create vendor nodes

```sql
SELECT * FROM ag_catalog.cypher('graph_name', $$
CREATE (kb:Actor {name: 'Kevin Bacon'}),
        (a1:Actor {name: 'Actor 1'}),
        (a2:Actor {name: 'Actor 2'}),
        (d1:Director {name: 'Director 1'}),
        (d2:Director {name: 'Director 2'})
$$) as (a agtype);
```

Create SOW nodes:

```sql
SELECT * FROM ag_catalog.cypher('graph_name', $$
CREATE (m1:Movie {title: 'Movie 1'}),
       (m2:Movie {title: 'Movie 2'})
$$) as (a agtype);​
```

Create relationships indicating vendors submitted invoices:

```sql
SELECT * FROM ag_catalog.cypher('graph_name', $$
MATCH (kb:Actor {name: 'Kevin Bacon'}), (m1:Movie {title: 'Movie 1'})
CREATE (kb)-[:ACTED_IN]->(m1)
$$) as (a agtype);

SELECT * FROM ag_catalog.cypher('graph_name', $$
MATCH (kb:Actor {name: 'Kevin Bacon'}), (m2:Movie {title: 'Movie 2'})
CREATE (kb)-[:ACTED_IN]->(m2)
$$) as (a agtype);​
```

Create relationships indicating other actors acted in the same movies:

```sql
SELECT * FROM ag_catalog.cypher('graph_name', $$
MATCH (a1:Actor {name: 'Actor 1'}), (m1:Movie {title: 'Movie 1'})
CREATE (a1)-[:ACTED_IN]->(m1)
$$) as (a agtype);

SELECT * FROM ag_catalog.cypher('graph_name', $$
MATCH (a2:Actor {name: 'Actor 2'}), (m2:Movie {title: 'Movie 2'})
CREATE (a2)-[:ACTED_IN]->(m2)
$$) as (a agtype);​
```

Create relationships indicating directors directed the movies:

```sql
SELECT * FROM ag_catalog.cypher('graph_name', $$
MATCH (d1:Director {name: 'Director 1'}), (m1:Movie {title: 'Movie 1'})
CREATE (d1)-[:DIRECTED]->(m1)
$$) as (a agtype);

SELECT * FROM ag_catalog.cypher('graph_name', $$
MATCH (d2:Director {name: 'Director 2'}), (m2:Movie {title: 'Movie 2'})
CREATE (d2)-[:DIRECTED]->(m2)
$$) as (a agtype);​
```



# 6.3 Execute cypher queries


Now that you have a populated graph, you can use cypher queries to demonstrate these relationships.

Find all invoices submitted by TODO vendor:

TODO: Fix the `graph_name` reference above to use a standard one for the solution accelerator so it doesn't need to be updated in the queries...

```sql
SELECT * FROM ag_catalog.cypher('graph_name', $$
MATCH (kb:Actor {name: 'Kevin Bacon'})-[:ACTED_IN]->(m:Movie)<-[:ACTED_IN]-(coactor:Actor)
RETURN coactor.name AS CoActor
$$) as (CoActor agtype);​
```

Find all SOWs for vendor TODO:

```sql
SELECT * FROM ag_catalog.cypher('graph_name', $$
MATCH (kb:Actor {name: 'Kevin Bacon'})-[:ACTED_IN]->(m:Movie)<-[:DIRECTED]-(d:Director)
RETURN d.name AS Director
$$) as (Director agtype);​
```

Find all movies where Kevin Bacon and another specific actor have acted together:

```sql
SELECT * FROM ag_catalog.cypher('graph_name', $$
MATCH (kb:Actor {name: 'Kevin Bacon'})-[:ACTED_IN]->(m:Movie)<-[:ACTED_IN]-(coactor:Actor {name: 'Actor 1'})
RETURN m.title AS Movie
$$) as (Movie agtype);​
```

Find all directors who have directed movies with Kevin Bacon and another specific actor:

```sql
SELECT * FROM ag_catalog.cypher('graph_name', $$
MATCH (kb:Actor {name: 'Kevin Bacon'})-[:ACTED_IN]->(m:Movie)<-[:ACTED_IN]-(coactor:Actor {name: 'Actor 1'})
MATCH (d:Director)-[:DIRECTED]->(m)
RETURN d.name AS Director
$$) as (Director agtype);​
```

These queries will help you explore the relationships between vendors, invoices, and their associated SOWs in your graph database. Remember to replace 'graph_name' with the actual name of your graph.
