# 5.6 Add Copilot Chat To UI

In this step, you will review the `CopilotChat` component of the front-end application and enable it so you can chat with your copilot via the Portal UI. You can create an interactive and responsive chat interface that enhances user engagement by leveraging React's dynamic component-based architecture and its seamless integration with real-time messaging APIs. The copilot chat feature empowers the application to provide real-time conversation capabilities, handle complex state management, and deliver intuitive interactions that make the user experience more engaging and efficient.

## Review Copilot Chat UI Component

The _Woodgrove Bank Contract Management Portal_ is a single-page application (SPA) built using React.js, a popular JavaScript framework for interactive user interfaces.

A React component, `CopilotChat`, has been provided to allow you to easily integrate the copilot capability into the UI of the portal application. This component is implemented in the `src/userportal/src/components/CopilotChat.jsx` file. Open it now in VS Code and explore the code in sections. You can also expand the section below to see the code inline and review the explanations for each line of code.

???+ info "Copilot Chat REACT component code."

    ```javascript linenums="1" title="src/userportal/src/components/CopilotChat.jsx"
    import React, { useState, useEffect, useRef } from 'react';
    import ReactMarkdown from 'react-markdown';
    import api from '../api/Api'; // Adjust the path as necessary
    
    const CopilotChat = () => {
      const [messages, setMessages] = useState([]);
      const [input, setInput] = useState('');
      const messagesEndRef = useRef(null);
      const [error, setError] = useState('');
      const [isThinking, setIsThinking] = useState(false);
    
      const handleSendMessage = async () => {
        if (input.trim() === '') return;
    
        const prompt = input;
        setInput('');
    
        setIsThinking(true);
    
        const userMessage = { role: 'user', content: prompt };
        setMessages([...messages, userMessage]);
    
        setError('');
    
        try {
          const response = await api.completions.chat(prompt, messages);
    
          const assistantMessage = { role: 'assistant', content: response };
          setMessages([...messages, userMessage, assistantMessage]);
        } catch (error) {
          console.error('Error sending message:', error);
          setError('Error sending message. Please try again.');
        } finally {
            setIsThinking(false);
        }
    
      };
    
      useEffect(() => {
        if (messagesEndRef.current) {
          messagesEndRef.current.scrollIntoView({ behavior: 'smooth' });
        }
      }, [messages]);
    
      return (
        <div className="ai-chat container mt-4">
          <div className="messages mb-3 border p-3" style={{ minHeight: '20em', maxHeight: '50em', overflowY: 'scroll' }}>
            {messages.map((msg, index) => (
              <div key={index} className={`message ${msg.role} mb-2 d-flex ${msg.role === 'user' ? 'justify-content-end' : 'justify-content-start'}`}>
                {!error && index === messages.length - 1 && <div ref={messagesEndRef} />}
                <div className={`alert ${msg.role === 'user' ? 'alert-primary' : 'alert-secondary'}`} style={{ maxWidth: '90%' }} role="alert">
                  <ReactMarkdown>{msg.content}</ReactMarkdown>
                </div>
              </div>
            ))}
            {error && <div className="alert alert-danger" role="alert">{error}<div ref={messagesEndRef} /></div>}
            {isThinking && <div className="d-flex justify-content-center">
                <div className="spinner-border text-info" role="status">
                  <span className="visually-hidden">Thinking...</span>
                </div>
                <div ref={messagesEndRef} />
              </div>}
          </div>
          <div className="input-container d-flex">
            <textarea className="form-control me-2"
              value={input}
              onChange={(e) => setInput(e.target.value)}
              onKeyDown={(e) => { if (e.key === 'Enter') { handleSendMessage(e); e.preventDefault(); return false; } }}
              placeholder="Type a message..."
            ></textarea>
            <button className="btn btn-primary" onClick={handleSendMessage}>Send</button>
          </div>
        </div>
      );
    };
    
    export default CopilotChat;
    ```

1. **Import components and libraries** (lines 1-3): Required components and libraries are imported.

2. **Load environment variables** (line 23). The _load_dotenv()_ function imports environment variable values stored in the `.env` file you created in the `src\api\app` folder.

3. **Define the `CopilotChat` functional component** (line 5). Components in React.js are created using a _functional component_ or _class component_.

4. **Declare state variables** (lines 6-10): State variables are used to maintain the chat session state, including message history.

5. **Provide function for sending messages to the API** (lines 12-37): The `handleSendMessage` function sends messages asynchronously to the _Woodgrove Bank API_. This function handles the UI's interaction with the backend `/chat` endpoint, sending the _user query_ and _chat history_ to the API.

6. **Handle changes in the messages collection** (lines 39-43): The `useEffect` hook is used to run code in response to changes in the messages array.

7. **Return the component** (lines 45-75): The return statement renders the component's JSX, defining how it is presented in the web browser.

8. **Export the `CopilotChat` component** (line 77): Exports the `CopilotChat` component as the default export.

## Enable the Copilot Chat UI

To enable the copilot chat feature in the _Woodgrove Bank Contract Management Portal_ UI, you will add a reference to the component on the `Dashboard` page of the UI. The dashboard page is defined in the `src/userportal/src/pages/dashboard/dashboard.jsx` file. Expand the section below to review the code for the page below.

???+ info "Dashboard page code"

    ```javascript linenums="1" title="src/userportal/src/pages/dashboard/dashboard.jsx"
    import React from 'react';
    
    const Dashboard = () => {
      return (
        <div className="table-responsive">
          <div className="d-flex justify-content-between flex-wrap flex-md-nowrap align-items-center pt-3 pb-2 mb-3 border-bottom">
            <h1 className="h2">Dashboard</h1>
          </div>

        </div>
      );
    };
    
    export default Dashboard;
    ```

1. In the VS Code **Explorer**, navigate to the `src/userportal/src/pages/dashboard` folder and open the `dashboard.jsx` file.

2. To import the AI chat component, insert the following `import` statement directly below the `import React from 'react';` line at the top of the file.

    ```javascript
    import CopilotChat from '../../components/CopilotChat';
    ```

3. Insert the following code below the closing tag of `<div>` containing the _Dashboard_ header (line 9). This will insert the component within the `const Dashboard =() => {}` functional component block of the dashboard page.

    ```javascript
    <CopilotChat />
    ```

4. The final `Dashboard` code should look like the following:

    ```javascript linenums="1" title="src/userportal/src/pages/dashboard/dashboard.jsx"
    import React from 'react';
    import CopilotChat from '../../components/CopilotChat';
    
    const Dashboard = () => {
      return (
        <div className="table-responsive">
          <div className="d-flex justify-content-between flex-wrap flex-md-nowrap align-items-center pt-3 pb-2 mb-3 border-bottom">
            <h1 className="h2">Dashboard</h1>
          </div>
          <CopilotChat />
        </div>
      );
    };
    
    export default Dashboard;
    ```
